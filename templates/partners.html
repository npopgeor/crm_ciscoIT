{% extends 'layout.html' %}

{% block content %}

<h2 class="mb-3">🤝 Partner List</h2>
<div class="mb-4">
  <a href="{{ url_for('add_partner') }}" class="btn btn-primary">➕ Add New Partner</a>
</div>

<div class="table-responsive shadow-sm rounded border">
  <table class="table table-hover align-middle mb-0">
    <thead class="table-light text-nowrap">
      <tr class="text-secondary">
        <th>Name</th>
        <th style="width: 40%;">Notes</th>
        <th style="width: 30%;">Assigned Customers</th>
        <th class="text-center" style="width: 120px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for partner in partners %}
      <tr>
        <td class="fw-semibold">
          <a href="{{ url_for('partner_detail', partner_id=partner.id) }}">{{ partner.name }}</a>
        </td>
        <td>
          <span class="d-inline-block text-truncate" style="max-width: 300px;" title="{{ partner.notes }}">
            {{ partner.notes or '—' }}
          </span>
        </td>
        <td>
          {% if partner.customers %}
            <ul class="mb-0 ps-3">
              {% for customer in partner.customers %}
                <li>{{ customer.name }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>
        <td class="text-center">
          <a href="{{ url_for('edit_partner', partner_id=partner.id) }}" class="btn btn-sm btn-outline-warning me-1">✏️</a>
          <a href="{{ url_for('delete_partner', partner_id=partner.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this partner?');">🗑</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<a href="/" class="btn btn-link mt-4">⬅ Back to Home</a>

<script>

  document.addEventListener("DOMContentLoaded", function () {
    document.addEventListener("keydown", function (event) {
      if ((event.key === "Escape" || event.keyCode === 27) &&
          document.activeElement.tagName !== "TEXTAREA" &&
          document.activeElement.tagName !== "INPUT") {
        
        event.preventDefault(); // Prevent default Escape behavior (like modal close)
        console.log("Forced redirect on Esc");

        setTimeout(() => {
          window.location.href = "/dashboard";
        }, 100);
      }
    });
  });


</script>

{% endblock %}
